<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Space Evader</title>
</head>

<body style="margin:0px;padding:0px;overflow:hidden;">


    <script>
    window.onload = function () {
        var camera, scene, renderer;
        var cameraControls;
        var group;
        var spaceship = new THREE.Group();
        var moveRight = false;
        var moveLeft = false;
        var moveUp = false;
        var moveDown = false;
        var rotateLeft = false;
        var rotateRight = false;
        var schipKeuze = prompt("voer een 1 in voor een generiek ruimteschip, 2 voor een spaceshuttle en 3 voor een vliegtuigje");
        var draaisnelheid = 0; //de snelheid van de rotatie

        /**
        * @param {string} modelPath
        * @param {string} modelName
        * @param {string} texturePath
        * @param {string} textureName
        * @param {function(THREE.Mesh): void} onload
        * @return {void}
        */
        
        function loadOBJModel(modelPath, modelName, texturePath, textureName, onload){
            new THREE.MTLLoader()
                .setPath(texturePath)
                .load(textureName, function(materials){
                    materials.preload();
                    new THREE.OBJLoader()
                        .setPath(modelPath)
                        .setMaterials(materials)
                        .load(modelName, function(object){
                            onload(object);
                        }, function () {} , function (e){console.log("Error loading model"); console.log(e); });
                });
        }

        function init() {
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
            cameraControls = new THREE.OrbitControls(camera);
            camera.position.z = 10;
            camera.position.y = 0;
            camera.position.x = 100;
            cameraControls.update();
            scene = new THREE.Scene();

            if(schipKeuze == 1){ // het eerste ruimteschip
                new THREE.MTLLoader() 
				.setPath( '3d/spaceship/' )
						.load( 'spaceship.mtl', function ( materials ) {
					materials.preload();

					new THREE.OBJLoader()
						.setMaterials( materials )
						.setPath( '3d/spaceship/' )
						.load( 'spaceship.obj', function ( object ) {
							object.position.set(85, 1, 10);
							var a = 0.01;
							object.scale.set(a, a, a);
                            object.rotation.y = (Math.PI/2) * 3;
                            draaisnelheid = 0.005;
							spaceship.add( object );
						} );
				} );
            }
            else if(schipKeuze == 2) { // een spaceshuttle als ruimteschip
                new THREE.MTLLoader()
				    .setPath( '3d/spaceshuttle/' )
                    .load( 'spaceshuttle.mtl', function ( materials ) {
					materials.preload();

					new THREE.OBJLoader()
						.setMaterials( materials )
						.setPath( '3d/spaceshuttle/' )
						.load( 'spaceshuttle.obj', function ( object ) {
							object.position.z = 20;
							var a = 0.5;
							object.scale.set(a, a, a)
                            object.position.z += 10;
                            object.rotation.x = -1.413717;
                            object.rotation.y = 0; //niet mee prutsen
                            object.rotation.z = Math.PI;
                            draaisnelheid = 0.005;
							spaceship.add( object );
						} );
				} );
            }
            else if(schipKeuze == 3) { // een vliegtuigje als "ruimteschip"
            loadOBJModel("3d/spaceship/", "spaceship.mtl", "3d/spaceship/", "spaceship.obj", (object) => {
                    var a = 0.01;
                    object.scale.set(a, a, a);
                    object.position.z = 20;
                    draaisnelheid = 0.005;
                    spaceship.add(object);
                    console.log("gelukt");
                });
            }
            
            scene.add(spaceship);
            document.addEventListener("keydown", onDocumentKeyDown, false);
            document.addEventListener("keyup", onDocumentKeyUp, false);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight + 5);
            document.body.appendChild(renderer.domElement);

            window.addEventListener('resize', onWindowResize, false);
            
            var geometry = new THREE.PlaneGeometry(1000, 30, 100);
            var material = new THREE.MeshBasicMaterial({ color: 0x404040, side: THREE.DoubleSide });
            var plane = new THREE.Mesh(geometry, material);
            plane.rotation.x = Math.PI / 2.0;
            plane.position.x = 100;
            plane.position.y = -0.5;
            plane.position.z = 10;
            scene.add(plane);

            var light = new THREE.AmbientLight(0x404040);
            light.intensity = 4;
            scene.add(light);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        

        //Later wat parameters erin doen voor bv: moeilijksheidgraad etc.
        function MakeObject(){
            group = new THREE.Group();

            //Het laden van het model en de materials(textures)
            var mtlLoader = new THREE.MTLLoader();
            mtlLoader.setTexturePath("models/Obstacles/");
            mtlLoader.setPath("models/Obstacles/");
            mtlLoader.load("Boulder.mtl", function(materials){
                materials.preload();

                var objLoader = new THREE.OBJLoader()
                objLoader.setMaterials(materials)
                objLoader.setPath("models/Obstacles/")
                objLoader.load("Boulder.obj", function(geometry){
                    //hier kunnen we later wel aanpassen hoeveel objecten er zijn(moeilijksheidgraad)
                    for(var i = 0; i < 250; i++){
                        var obstacle = geometry.clone();
                        obstacle.position.set(Math.random() * -200, Math.random() * 10, Math.random() * 50);
                        obstacle.scale.set(1, 1, 1);                    
                        group.add(obstacle);    
                    }
                });
            });
            scene.add(group);
        }

        function onDocumentKeyDown(event) {
            var keyCode = event.which;
            
            if (keyCode == 90) {  //z key voor rotatie over rechts
                rotateRight = true;
                
            } else if (keyCode == 88) { // x key voor rotatie over links
                rotateLeft = true;
                
            } else if (keyCode == 37) { // left key voor bewegen naar links
                moveLeft = true;
                
            } else if (keyCode == 39) { // right key voor bewegen naar rechts
                moveRight = true;
                
            } else if (keyCode == 38) { // up key voor naar boven
                moveUp = true;
                
            } else if (keyCode == 40) { //down key voor naar beneden
                moveDown = true;
            }            
            
        };

        function onDocumentKeyUp(event) {
            var keyCode = event.which;
            
            if (keyCode == 90) {  //z key voor rotatie over rechts
                rotateRight = false;
                
            } else if (keyCode == 88) { // x key voor rotatie over links
                rotateLeft = false;
                
            } else if (keyCode == 37) { // left key voor bewegen naar links
                moveLeft = false;
                
            } else if (keyCode == 39) { // right key voor bewegen naar rechts
                moveRight = false;
                
            } else if (keyCode == 38) { // up key voor naar boven
                moveUp = false;
                
            } else if (keyCode == 40) { //down key voor naar beneden
                moveDown = false;
            }       
            //animate();
        };
        

        function animate() {
            requestAnimationFrame(animate);
            cameraControls.update();
            group.position.x += 0.5;
            if (group.position.x > 300){
                scene.remove(group);
                MakeObject();
            }

            if(moveRight == true)
            {
                spaceship.position.x -= 0.01;
            }
            if(moveLeft == true)
            {
                spaceship.position.x += 0.01;
            }
            if(moveUp == true)
            {
                spaceship.position.y += 0.01;
            }
            if(moveDown == true)
            {
                spaceship.position.y -= 0.01;
            }
            if(rotateRight == true)
            {
                spaceship.rotation.z += draaisnelheid;
            }
            if(rotateLeft == true)
            {
                spaceship.rotation.z -= draaisnelheid;
            }

            renderer.render(scene, camera);
        }

        init();
        MakeObject();
        animate();
    }
    </script>

    <script src="three.min.js"></script>
    <script src="OrbitControls.js"></script>
    <script src="MTLLoader.js"></script>
    <script src="OBJLoader.js"></script>
</body>

</html>